"use strict";(self["webpackChunkticketing"]=self["webpackChunkticketing"]||[]).push([[456],{2157:function(t,e,s){s.d(e,{n:function(){return i}});const i=t=>{for(var e in t)return!1;return!0}},897:function(t,e,s){s.d(e,{Z:function(){return V}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",[s("v-dialog",{attrs:{"max-width":"900"},model:{value:t.solutionsDialog,callback:function(e){t.solutionsDialog=e},expression:"solutionsDialog"}},[t.isAddNew?s("div",[s("div",{staticClass:"modalHeader"},[s("v-btn",{staticClass:"text-capitalize",attrs:{color:"success",small:"",disabled:t.loading},on:{click:function(e){t.solutionDialog=!0}}},[s("span",[t._v("Add New")])])],1),s("v-divider")],1):t._e(),s("v-data-table",{staticClass:"elevation-1 rounded-t-0",attrs:{headers:t.headers,items:t.solutions,"items-per-page":5,loading:t.loading,"loading-text":"Loading... Please wait"},scopedSlots:t._u([{key:"item.remarks",fn:function(e){var i=e.item;return[s("div",{staticClass:"text-truncate",staticStyle:{"max-width":"250px"}},[t._v(" "+t._s(i.remarks)+" ")])]}},{key:"item.created_at",fn:function(e){var i=e.item;return[s("span",[t._v(t._s(t.setCreatedAtFormat(i.created_at)))])]}}],null,!0)})],1),t.solutionDialog?s("v-dialog",{attrs:{persistent:t.isPersistent,"max-width":"500px"},model:{value:t.solutionDialog,callback:function(e){t.solutionDialog=e},expression:"solutionDialog"}},[s("v-form",{ref:"solutionForm",on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[s("v-card",{attrs:{disabled:t.loadingForm}},[s("v-card-title",[t._v(" Solution ")]),s("v-card-subtitle",[s("small",[t._v("Note: All fields are required.")])]),s("v-card-text",[s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-text-field",{ref:"keyword",attrs:{label:"Keyword",rules:t.saveStatus?[t.rules.required,t.rules.minimum(2),t.rules.maximum(100)]:[],"hide-details":"auto",outlined:"",dense:""},model:{value:t.solutionForm.keyword,callback:function(e){t.$set(t.solutionForm,"keyword",e)},expression:"solutionForm.keyword"}})],1),s("v-col",{attrs:{cols:"12"}},[s("v-textarea",{ref:"remarks",attrs:{label:"Remarks",rules:t.saveStatus?[t.rules.required,t.rules.minimum(2),t.rules.maximum(5e3)]:[],"hide-details":"auto",rows:"4",outlined:"",dense:""},model:{value:t.solutionForm.remarks,callback:function(e){t.$set(t.solutionForm,"remarks",e)},expression:"solutionForm.remarks"}})],1)],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{on:{click:function(e){t.solutionDialog=!1}}},[t._v(" Close ")]),s("v-btn",{attrs:{color:"success",type:"submit"}},[t._v(" Save ")])],1)],1)],1)],1):t._e()],1)},a=[],o=s(629),r=s(381),l=s.n(r),n=s(3659),c={name:"Solutions",props:["isAddNew"],data:()=>({headers:[{text:"Keyword",value:"keyword"},{text:"Remarks",value:"remarks"},{text:"Date Created",value:"created_at"},{text:"Action",value:"action",sortable:!1}],rules:n.Z,solutionDialog:!1,isPersistent:!1,solutionForm:{ticket_id:null,keyword:null,remarks:null},saveStatus:!1}),created(){this.getRecords()},computed:{...(0,o.rn)(["loading","solutions"]),...(0,o.rn)("myQueue",["loadingForm"]),solutionsDialog:{get:function(){return!0},set:function(){this.$emit("closeSolutionsDialog")}}},methods:{...(0,o.nv)("myQueue",["createSolution"]),async getRecords(){this.$store.commit("setSolutions",[]),await this.$store.dispatch("getSolutions",this.$route.params.id),this.solutionForm.ticket_id=this.$route.params.id},async onSubmit(){this.saveStatus=!0,await new Promise((t=>setTimeout(t,200))),this.loadingForm||this.$refs.solutionForm.validate()&&(this.isPersistent=!0,await this.createSolution(this.solutionForm),this.solutionsDialog=!1,this.solutionDialog=!1,this.$refs.solutionForm.reset(),this.isPersistent=!1)},setCreatedAtFormat(t){return l()(t).format("MMM D, YYYY h:mm A")}},watch:{solutionDialog(t){t&&setTimeout((()=>{this.$refs.keyword.focus()}),200)}}},u=c,d=s(1001),m=s(3453),v=s.n(m),f=s(680),g=s(3237),h=s(7118),p=s(2102),_=s(4228),y=s(4998),k=s(4497),D=s(1418),x=s(6232),b=s(2877),w=s(9762),S=s(5978),C=s(4350),Z=(0,d.Z)(u,i,a,!1,null,"4dbcd4a5",null),V=Z.exports;v()(Z,{VBtn:f.Z,VCard:g.Z,VCardActions:h.h7,VCardSubtitle:h.Qq,VCardText:h.ZB,VCardTitle:h.EB,VCol:p.Z,VContainer:_.Z,VDataTable:y.Z,VDialog:k.Z,VDivider:D.Z,VForm:x.Z,VRow:b.Z,VSpacer:w.Z,VTextField:S.Z,VTextarea:C.Z})},4439:function(t,e,s){s.d(e,{Z:function(){return h}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-dialog",{attrs:{"max-width":"900"},model:{value:t.ticketLogsDialog,callback:function(e){t.ticketLogsDialog=e},expression:"ticketLogsDialog"}},[s("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.ticketLogs,"items-per-page":5,loading:t.loading,"loading-text":"Loading... Please wait"},scopedSlots:t._u([{key:"item.created_at",fn:function(e){var i=e.item;return[s("span",[t._v(t._s(t.setCreatedAtFormat(i.created_at)))])]}}],null,!0)})],1)},a=[],o=s(629),r=s(381),l=s.n(r),n={name:"TicketLogs",data:()=>({headers:[{text:"Category",value:"category.name"},{text:"Status",value:"ticket_status.name"},{text:"Priority",value:"priority_status.name"},{text:"Department",value:"department.name"},{text:"Assigned To",value:"assignee.full_name"},{text:"Date Created",value:"created_at"}]}),created(){this.$store.commit("setTicketLogs",[]),this.$store.dispatch("getTicketLogs",this.$route.params.id)},computed:{...(0,o.rn)(["loading","ticketLogs"]),ticketLogsDialog:{get:function(){return!0},set:function(){this.$emit("closeTicketLogsDialog")}}},methods:{setCreatedAtFormat(t){return l()(t).format("MMM D, YYYY h:mm A")}}},c=n,u=s(1001),d=s(3453),m=s.n(d),v=s(4998),f=s(4497),g=(0,u.Z)(c,i,a,!1,null,null,null),h=g.exports;m()(g,{VDataTable:v.Z,VDialog:f.Z})},7187:function(t,e,s){s.r(e),s.d(e,{default:function(){return Y}});var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-row",[i("v-col",{attrs:{cols:"12",md:"8"}},[i("v-card",{attrs:{disabled:t.loadingForm}},[t.loadingRecords?i("div",[i("v-card-text",[i("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}}),i("br"),i("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}}),i("br"),i("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}})],1)],1):i("div",[i("v-card-subtitle",{staticClass:"d-flex"},[i("v-icon",{staticClass:"ml-2 mr-5"},[t._v("mdi-email-outline")]),i("div",[i("h3",{staticClass:"font-weight-black"},[t._v(" Ticket #"+t._s(t.id)+" - "+t._s(t.subject)+" ")]),t._v(" "+t._s(t.setCreatedAtFormat(t.createdAt))+" ("),i("i",[t._v(t._s(t.setFromNow(t.createdAt)))]),t._v(") ")]),i("v-spacer"),i("router-link",{attrs:{to:{name:"MyQueue"}}},[t._v("Back")])],1),i("v-card-text",{staticClass:"d-flex"},[i("v-img",{staticClass:"mr-3 rounded",attrs:{src:s(6229),"max-height":"40","max-width":"40"}}),i("div",[i("div",{staticClass:"font-weight-bold"},[t._v(t._s(t.client))]),i("div",[t._v(t._s(t.email))])])],1),i("v-card-text",{staticClass:"d-flex"},[i("v-icon",{staticClass:"ml-3 mr-6",attrs:{small:""}},[t._v("mdi-email-outline")]),i("div",{staticClass:"pre-formatted"},[t._v(" "+t._s(t.description)+" ")])],1),i("v-card-text",t._l(t.replies,(function(e){return i("div",{key:e.id,staticClass:"rounded py-3 mb-3",staticStyle:{"background-color":"#e6e6e6"}},[i("div",{staticClass:"ml-13"},[i("div",[i("span",{staticClass:"font-weight-bold"},[t._v(t._s(e.agent))]),t._v(" replied ")]),i("i",[t._v(t._s(t.setFromNow(e.created_at)))])]),i("br"),i("div",{staticClass:"d-flex"},[i("v-icon",{staticClass:"ml-3 mr-6",attrs:{small:""}},[t._v("mdi-email-outline")]),i("div",{staticClass:"pre-formatted"},[t._v(" "+t._s(e.message)+" ")])],1)])})),0),i("v-card-text",{directives:[{name:"show",rawName:"v-show",value:t.showReply,expression:"showReply"}]},[i("div",{staticClass:"px-3 py-2 rounded-t",staticStyle:{"background-color":"#1976d2",color:"#ffffff"}},[i("v-icon",{attrs:{small:"",dark:""}},[t._v("mdi-reply-outline")]),t._v(" To: "+t._s(t.email)+" ")],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-textarea",{ref:"reply",staticClass:"rounded-0",attrs:{rules:[t.rules.required,t.rules.minimum(2),t.rules.maximum(5e3)],outlined:"",dense:"",rows:"8","hide-details":"auto"},model:{value:t.reply,callback:function(e){t.reply=e},expression:"reply"}})],1)],1),i("div",{staticClass:"px-3 py-2 rounded-b d-flex",staticStyle:{"background-color":"#1976d2",color:"#ffffff"}},[i("v-btn",{staticClass:"text-capitalize",attrs:{small:""},on:{click:t.sendReply}},[i("v-icon",{attrs:{small:""}},[t._v("mdi-send-outline")]),t._v(" Send ")],1),i("v-spacer"),i("v-btn",{attrs:{icon:"",small:"",dark:""},on:{click:function(e){t.showReply=!1}}},[i("v-icon",{attrs:{small:""}},[t._v("mdi-trash-can-outline")])],1)],1)],1),i("v-card-actions",[i("v-btn",{staticClass:"text-capitalize ml-15",attrs:{small:""},on:{click:t.writeReply}},[i("v-icon",{attrs:{small:""}},[t._v("mdi-reply-outline")]),t._v(" Reply ")],1),i("v-btn",{staticClass:"text-capitalize",attrs:{small:""},on:{click:function(e){t.ticketLogsDialog=!0}}},[i("v-icon",{attrs:{small:""}},[t._v("mdi-file-document-outline")]),t._v(" View Logs ")],1),i("v-btn",{staticClass:"text-capitalize",attrs:{small:""},on:{click:function(e){t.solutionsDialog=!0}}},[i("v-icon",{attrs:{small:""}},[t._v("mdi-book-open-page-variant-outline")]),t._v("  Solution ")],1)],1)],1)])],1),i("v-col",{attrs:{cols:"12",md:"4"}},[i("v-form",{ref:"form"},[i("v-card",{attrs:{disabled:t.loadingForm}},[i("div",[i("v-card-subtitle",{staticClass:"text-uppercase font-weight-bold"},[t._v(" Properties "),i("v-divider")],1),i("v-card-text",[i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-autocomplete",{ref:"category",attrs:{rules:[t.rules.required],items:t.categories,"item-text":"name","item-value":"id",label:"Category","hide-details":"auto"},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-select",{ref:"ticketStatus",attrs:{rules:[t.rules.required],items:t.ticketStatuses,"item-text":"name","item-value":"id",label:"Status","hide-details":"auto",disabled:!t.form.agent},on:{change:t.setStatus},model:{value:t.form.ticketStatus,callback:function(e){t.$set(t.form,"ticketStatus",e)},expression:"form.ticketStatus"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-select",{ref:"priorityStatus",attrs:{rules:[t.rules.required],items:t.priorityStatuses,"item-text":"name","item-value":"id",label:"Priority","hide-details":"auto"},on:{change:function(e){return t.setPriority(t.priorityStatuses)}},scopedSlots:t._u([{key:"selection",fn:function(e){var s=e.item;return[i("v-icon",{staticClass:"mr-1",attrs:{small:"",color:t.getPriorityColor(s.id)}},[t._v("mdi-square")]),t._v(" "+t._s(s.name)+" "),5!=s.id?i("span",[t._v(" ("+t._s(s.hours)+" hrs)")]):t._e()]}},{key:"item",fn:function(e){var s=e.item;return[i("v-icon",{staticClass:"mr-1",attrs:{small:"",color:t.getPriorityColor(s.id)}},[t._v("mdi-square")]),t._v(t._s(s.name)+" "),5!=s.id?i("span",[t._v(" ("+t._s(s.hours)+" hrs)")]):t._e()]}}]),model:{value:t.form.priorityStatus,callback:function(e){t.$set(t.form,"priorityStatus",e)},expression:"form.priorityStatus"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-text-field",{ref:"dueDate",attrs:{label:"Due date*",rules:[t.rules.required,t.validDueDate],type:"datetime-local","hide-details":"auto",disabled:5!=t.form.priorityStatus},model:{value:t.form.dueDate,callback:function(e){t.$set(t.form,"dueDate",e)},expression:"form.dueDate"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-autocomplete",{ref:"department",attrs:{rules:[t.rules.required],items:t.departments,"item-text":"name","item-value":"id",label:"Department","hide-details":"auto"},on:{change:t.setAgents},model:{value:t.form.department,callback:function(e){t.$set(t.form,"department",e)},expression:"form.department"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-autocomplete",{ref:"agent",attrs:{items:t.agents,"item-text":"full_name","item-value":"id",label:"Agent","hide-details":"auto"},on:{change:t.setAgent},model:{value:t.form.agent,callback:function(e){t.$set(t.form,"agent",e)},expression:"form.agent"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("v-btn",{attrs:{color:"primary",block:""},on:{click:function(e){t.confirmationDialog=!0}}},[t._v(" Update ")])],1)],1)],1)],1)])],1)],1)],1),t.solutionsDialog?i("solutions",{attrs:{isAddNew:!0},on:{closeSolutionsDialog:t.closeSolutionsDialog}}):t._e(),t.ticketLogsDialog?i("ticket-logs",{on:{closeTicketLogsDialog:t.closeTicketLogsDialog}}):t._e(),t.confirmationDialog?i("confirmation-message",{attrs:{confirmationData:t.confirmationData},on:{closeConfirmationDialog:t.closeConfirmationDialog,onSubmit:t.onSubmit}}):t._e()],1)},a=[],o=s(629),r=s(2157),l=s(381),n=s.n(l),c=s(3659),u=s(4439),d=s(897),m=s(5081),v={components:{TicketLogs:u.Z,Solutions:d.Z,ConfirmationMessage:m.Z},data:()=>({rules:c.Z,subject:null,createdAt:null,client:null,email:null,description:null,id:null,form:{category:null,ticketStatus:null,priorityStatus:null,department:null,agent:null,dueDate:null},solutionsDialog:!1,isShowSolutionBtn:!1,ticketLogsDialog:!1,confirmationDialog:!1,confirmationData:{title:"Are you sure you want to update?",text:"This action cannot be undone.",closeBtnText:"Cancel",closeBtnColor:"gray",saveBtnText:"Update",saveBtnColor:"primary"},invalidDueDateText:null,showReply:!1,reply:null}),created(){this.getRecord()},computed:{...(0,o.rn)("myQueue",["loadingRecords","record","replies","categories","ticketStatuses","priorityStatuses","departments","loadingForm","agents","errors"]),...(0,o.Se)("auth",["user"])},methods:{...(0,o.nv)("myQueue",["getAgents","editRecord","updateRecord","doReply"]),async getRecord(){this.$store.commit("myQueue/setRecord",[]),this.$store.commit("myQueue/setAgents",[]),await this.editRecord(this.$route.params.id),Object.keys(this.record).length&&(this.id=this.record.id,this.subject=this.record.subject,this.createdAt=this.record.created_at,this.client=this.record.client,this.email=this.record.email,this.description=this.record.description,this.form.category=this.record.category_id,this.form.ticketStatus=this.record.ticket_status_id,this.form.priorityStatus=this.record.priority_status_id,this.form.dueDate=n()(this.record.due_date).format("YYYY-MM-DDTkk:mm"),this.form.department=this.record.department_id,this.form.agent=this.record.assigned_to)},setCreatedAtFormat(t){return n()(t).format("MMM D, YYYY h:mm A")},setFromNow(t){return n()(t).fromNow()},getPriorityColor(t){switch(t){case 1:return"green";case 2:return"blue";case 3:return"orange";case 4:return"red";default:return"grey"}},setPriority(t){const e=t.find((t=>t.id===this.form.priorityStatus));this.form.dueDate=n()(this.createdAt).add(e.hours,"hours").format("YYYY-MM-DDTkk:mm"),5==this.form.priorityStatus&&(this.form.dueDate=null)},setStatus(){1==this.form.ticketStatus&&(this.form.agent=null)},setAgents(){this.getAgents(this.form.department),this.form.agent=null,this.form.ticketStatus=1},setAgent(){1==this.form.ticketStatus&&(this.form.ticketStatus=2),this.form.agent||(this.form.ticketStatus=1)},validDueDate(t){return t!=this.invalidDueDateText||"Invalid Date"},async onSubmit(){if(this.$refs.form.validate()&&!this.loadingForm&&(this.confirmationDialog=!1,await this.updateRecord([this.id,this.form]),!(0,r.n)(this.errors))){let t="";Object.entries(this.errors).forEach((([e,s])=>{s&&(t||(t=e),"dueDate"==e&&(this.invalidDueDateText=this.form.dueDate),this.$refs.form.validate(),this.$refs[t].focus())}))}},async sendReply(){if(this.reply){if(!this.loadingForm){const t=this.user.first_name+" "+this.user.middle_name+" "+this.user.last_name,e={agent:t,ticket_id:this.id,message:this.reply,created_at:Date.now()};await this.doReply(e),this.showReply=!1}}else alert("Reply is required.")},closeSolutionsDialog(){this.solutionsDialog=!1},closeTicketLogsDialog(){this.ticketLogsDialog=!1},closeConfirmationDialog(){this.confirmationDialog=!1},writeReply(){this.showReply=!0,this.reply=`Hi ${this.client},\n\n`}},watch:{showReply(t){t&&setTimeout((()=>{this.$refs.reply.focus()}),200)}}},f=v,g=s(1001),h=s(3453),p=s.n(h),_=s(1835),y=s(680),k=s(3237),D=s(7118),x=s(2102),b=s(4228),w=s(1418),S=s(6232),C=s(6428),Z=s(7047),V=s(7003),A=s(2877),F=s(4999),T=s(9762),$=s(5978),R=s(4350),L=(0,g.Z)(f,i,a,!1,null,"78ed1de3",null),Y=L.exports;p()(L,{VAutocomplete:_.Z,VBtn:y.Z,VCard:k.Z,VCardActions:D.h7,VCardSubtitle:D.Qq,VCardText:D.ZB,VCol:x.Z,VContainer:b.Z,VDivider:w.Z,VForm:S.Z,VIcon:C.Z,VImg:Z.Z,VProgressLinear:V.Z,VRow:A.Z,VSelect:F.Z,VSpacer:T.Z,VTextField:$.Z,VTextarea:R.Z})},6229:function(t,e,s){t.exports=s.p+"img/default_selfie.aa40bfd1.jpg"}}]);
//# sourceMappingURL=ticketMyQueueEdit.d47272c4.js.map
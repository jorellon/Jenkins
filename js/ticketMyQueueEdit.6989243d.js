"use strict";(self["webpackChunkticketing"]=self["webpackChunkticketing"]||[]).push([[456],{7711:function(t,e,i){i.r(e),i.d(e,{default:function(){return Y}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",{attrs:{fluid:""}},[s("v-row",[s("v-col",{attrs:{cols:"12",md:"8"}},[s("v-card",{attrs:{disabled:t.loadingForm}},[t.loadingRecords?s("div",[s("v-card-text",[s("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}}),s("br"),s("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}}),s("br"),s("v-progress-linear",{attrs:{indeterminate:"",color:"grey"}})],1)],1):s("div",[s("v-card-subtitle",{staticClass:"d-flex"},[s("v-icon",{staticClass:"ml-2 mr-5"},[t._v("mdi-email-outline")]),s("div",[s("h3",{staticClass:"font-weight-black"},[t._v(" Ticket #"+t._s(t.id)+" - "+t._s(t.subject)+" ")]),t._v(" "+t._s(t._f("dateFormat")(t.createdAt))+" ("),s("i",[t._v(t._s(t._f("setFromNow")(t.createdAt)))]),t._v(") ")]),s("v-spacer"),s("router-link",{attrs:{to:{name:"MyQueue"}}},[t._v("Back")])],1),s("v-card-text",{staticClass:"d-flex"},[s("v-img",{staticClass:"mr-3 rounded",attrs:{src:i(6229),"max-height":"40","max-width":"40"}}),s("div",[s("div",{staticClass:"font-weight-bold"},[t._v(t._s(t._f("nameFormat")(t.client)))]),s("div",[t._v(t._s(t.email))]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.loanNumber&&t.project&&t.unit&&t.contact,expression:"loanNumber && project && unit && contact"}]},[s("br"),s("div",[s("span",{staticClass:"font-weight-medium"},[t._v("Loan No.:")]),t._v(" "+t._s(t.loanNumber)+" ")]),s("div",[s("span",{staticClass:"font-weight-medium"},[t._v("Project:")]),t._v(" "+t._s(t.project)+" ")]),s("div",[s("span",{staticClass:"font-weight-medium"},[t._v("Unit/Lot No.:")]),t._v(" "+t._s(t.unit)+" ")]),s("div",[s("span",{staticClass:"font-weight-medium"},[t._v("Contact:")]),t._v(" "+t._s(t.contact)+" ")])])])],1),s("v-card-text",{staticClass:"d-flex"},[s("v-icon",{staticClass:"ml-3 mr-6",attrs:{small:""}},[t._v("mdi-email-outline")]),s("div",{staticClass:"pre-formatted"},[t._v(" "+t._s(t.description)+" ")])],1),s("v-card-text",t._l(t.replies,(function(e){return s("div",{key:e.id,staticClass:"rounded py-3 mb-3 pr-3",style:e.user_id?"background-color: #e6e6e6":"border: 1px solid #e6e6e6"},[s("div",{staticClass:"ml-13"},[s("div",[s("span",{staticClass:"font-weight-bold"},[t._v(t._s(t._f("nameFormat")(e.agent)))]),t._v(" replied ")]),s("i",[t._v(t._s(t._f("setFromNow")(e.created_at)))])]),s("br"),s("div",{staticClass:"d-flex"},[s("v-icon",{staticClass:"ml-3 mr-6",attrs:{small:""}},[t._v("mdi-email-outline")]),s("div",{staticClass:"pre-formatted"},[t._v(" "+t._s(e.message)+" ")])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.attachments,expression:"item.attachments"}],staticClass:"ml-13 mt-8"},[s("v-btn",{staticClass:"text-capitalize",attrs:{small:"",color:e.user_id?"grey lighten-1":"grey lighten-4",disabled:t.downloading},on:{click:function(i){return t.download(e.id)}}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-file-download-outline")]),t._v(" "+t._s(e.attachments?e.attachments.substring(14):"")+" ")],1)],1)])})),0),s("v-card-text",{directives:[{name:"show",rawName:"v-show",value:t.showReply,expression:"showReply"}]},[s("div",{staticClass:"px-3 py-2 rounded-t",staticStyle:{"background-color":"#1976d2",color:"#ffffff"}},[s("v-icon",{attrs:{small:"",dark:""}},[t._v("mdi-reply-outline")]),t._v(" To: "+t._s(t.email)+" ")],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-textarea",{ref:"reply",staticClass:"rounded-0",attrs:{rules:[t.rules.required,t.rules.minimum(2),t.rules.maximum(5e3)],outlined:"",dense:"",rows:"8","hide-details":"auto"},model:{value:t.reply,callback:function(e){t.reply=e},expression:"reply"}})],1)],1),s("div",{staticClass:"px-3 pt-3 pb-2 rounded-b d-flex",staticStyle:{"background-color":"#1976d2",color:"#ffffff"}},[s("v-btn",{staticClass:"text-capitalize mr-2",attrs:{small:""},on:{click:t.sendReply}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-send-outline")]),t._v(" Send ")],1),s("v-file-input",{ref:"attachment",staticClass:"mt-0",attrs:{label:"Attachment",dark:"",dense:"","hide-details":"auto"},model:{value:t.attachment,callback:function(e){t.attachment=e},expression:"attachment"}}),s("v-spacer"),s("v-btn",{attrs:{icon:"",small:"",dark:""},on:{click:function(e){t.showReply=!1}}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-trash-can-outline")])],1)],1)],1),s("v-card-actions",[s("v-btn",{staticClass:"text-capitalize ml-15",attrs:{small:""},on:{click:t.writeReply}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-reply-outline")]),t._v(" Reply ")],1),s("v-btn",{staticClass:"text-capitalize",attrs:{small:""},on:{click:function(e){t.ticketLogsDialog=!0}}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-file-document-outline")]),t._v(" View Logs ")],1),s("v-btn",{staticClass:"text-capitalize",attrs:{small:""},on:{click:function(e){t.solutionsDialog=!0}}},[s("v-icon",{attrs:{small:""}},[t._v("mdi-book-open-page-variant-outline")]),t._v("  Solution ")],1)],1)],1)])],1),s("v-col",{attrs:{cols:"12",md:"4"}},[s("v-form",{ref:"form"},[s("v-card",{attrs:{disabled:t.loadingForm}},[s("div",[s("v-card-subtitle",{staticClass:"text-uppercase font-weight-bold"},[t._v(" Properties "),s("v-divider")],1),s("v-card-text",[s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-autocomplete",{ref:"category",attrs:{rules:[t.rules.required],items:t.categories,"item-text":"name","item-value":"id",label:"Category","hide-details":"auto"},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-select",{ref:"ticketStatus",attrs:{rules:[t.rules.required],items:t.ticketStatuses,"item-text":"name","item-value":"id",label:"Status","hide-details":"auto",disabled:!t.form.agent},on:{change:t.setStatus},model:{value:t.form.ticketStatus,callback:function(e){t.$set(t.form,"ticketStatus",e)},expression:"form.ticketStatus"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-select",{ref:"priorityStatus",attrs:{rules:[t.rules.required],items:t.priorityStatuses,"item-text":"name","item-value":"id",label:"Priority","hide-details":"auto"},on:{change:function(e){return t.setPriority(t.priorityStatuses)}},scopedSlots:t._u([{key:"selection",fn:function(e){var i=e.item;return[s("v-icon",{staticClass:"mr-1",attrs:{small:"",color:t.getPriorityColor(i.id)}},[t._v("mdi-square")]),t._v(" "+t._s(i.name)+" "),5!=i.id?s("span",[t._v(" ("+t._s(i.hours)+" hrs)")]):t._e()]}},{key:"item",fn:function(e){var i=e.item;return[s("v-icon",{staticClass:"mr-1",attrs:{small:"",color:t.getPriorityColor(i.id)}},[t._v("mdi-square")]),t._v(t._s(i.name)+" "),5!=i.id?s("span",[t._v(" ("+t._s(i.hours)+" hrs)")]):t._e()]}}]),model:{value:t.form.priorityStatus,callback:function(e){t.$set(t.form,"priorityStatus",e)},expression:"form.priorityStatus"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-text-field",{ref:"dueDate",attrs:{label:"Due date*",rules:[t.rules.required,t.validDueDate],type:"datetime-local","hide-details":"auto",disabled:5!=t.form.priorityStatus},model:{value:t.form.dueDate,callback:function(e){t.$set(t.form,"dueDate",e)},expression:"form.dueDate"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-autocomplete",{ref:"department",attrs:{rules:[t.rules.required],items:t.departments,"item-text":"name","item-value":"id",label:"Department","hide-details":"auto"},on:{change:t.setAgents},model:{value:t.form.department,callback:function(e){t.$set(t.form,"department",e)},expression:"form.department"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-autocomplete",{ref:"agent",attrs:{items:t.formatAgentsName,"item-text":"full_name","item-value":"id",label:"Agent","hide-details":"auto"},on:{change:t.setAgent},model:{value:t.form.agent,callback:function(e){t.$set(t.form,"agent",e)},expression:"form.agent"}})],1)],1),s("v-row",[s("v-col",{attrs:{cols:"12"}},[s("v-btn",{attrs:{color:"primary",block:""},on:{click:function(e){t.confirmationDialog=!0}}},[t._v(" Update ")])],1)],1)],1)],1)])],1)],1)],1),t.solutionsDialog?s("solutions",{attrs:{isAddNew:!0},on:{closeSolutionsDialog:t.closeSolutionsDialog}}):t._e(),t.ticketLogsDialog?s("ticket-logs",{on:{closeTicketLogsDialog:t.closeTicketLogsDialog}}):t._e(),t.confirmationDialog?s("confirmation-message",{attrs:{confirmationData:t.confirmationData},on:{closeConfirmationDialog:t.closeConfirmationDialog,onSubmit:t.onSubmit}}):t._e()],1)},a=[],o=i(629),r=i(2157),l=i(2929),n=i(381),c=i.n(n),d=i(3659),m=i(4439),u=i(897),v=i(5081),h={components:{TicketLogs:m.Z,Solutions:u.Z,ConfirmationMessage:v.Z},data:()=>({rules:d.Z,subject:null,createdAt:null,client:null,email:null,loanNumber:null,project:null,unit:null,contact:null,description:null,id:null,form:{category:null,ticketStatus:null,priorityStatus:null,department:null,agent:null,dueDate:null},solutionsDialog:!1,isShowSolutionBtn:!1,ticketLogsDialog:!1,confirmationDialog:!1,confirmationData:{title:"Are you sure you want to update?",text:"This action cannot be undone.",closeBtnText:"Cancel",closeBtnColor:"gray",saveBtnText:"Update",saveBtnColor:"primary"},invalidDueDateText:null,showReply:!1,reply:null,attachment:null,downloading:!1}),created(){this.getRecord()},computed:{...(0,o.rn)("myQueue",["loadingRecords","record","replies","categories","ticketStatuses","priorityStatuses","departments","loadingForm","agents","errors"]),...(0,o.Se)("auth",["user"]),formatAgentsName(){return(0,l.K)(this.agents)},formatClientName(){return(0,l.g)(this.client)}},methods:{...(0,o.nv)("myQueue",["getAgents","editRecord","updateRecord","doReply","doDownload"]),async getRecord(){this.$store.commit("myQueue/setRecord",[]),this.$store.commit("myQueue/setAgents",[]),await this.editRecord(this.$route.params.id),Object.keys(this.record).length&&(this.id=this.record.id,this.subject=this.record.subject,this.createdAt=this.record.created_at,this.client=this.record.client,this.email=this.record.email,this.loanNumber=this.record.loan_number,this.project=this.record.project,this.unit=this.record.unit,this.contact=this.record.contact,this.description=this.record.description,this.form.category=this.record.category_id,this.form.ticketStatus=this.record.ticket_status_id,this.form.priorityStatus=this.record.priority_status_id,this.form.dueDate=c()(this.record.due_date).format("YYYY-MM-DDTkk:mm"),this.form.department=this.record.department_id,this.form.agent=this.record.assigned_to)},getPriorityColor(t){switch(t){case 1:return"green";case 2:return"blue";case 3:return"orange";case 4:return"red";default:return"grey"}},setPriority(t){const e=t.find((t=>t.id===this.form.priorityStatus));this.form.dueDate=c()(this.createdAt).add(e.hours,"hours").format("YYYY-MM-DDTkk:mm"),5==this.form.priorityStatus&&(this.form.dueDate=null)},setStatus(){1==this.form.ticketStatus&&(this.form.agent=null)},setAgents(){this.getAgents(this.form.department),this.form.agent=null,this.form.ticketStatus=1},setAgent(){1==this.form.ticketStatus&&(this.form.ticketStatus=2),this.form.agent||(this.form.ticketStatus=1)},validDueDate(t){return t!=this.invalidDueDateText||"Invalid Date"},async onSubmit(){if(this.$refs.form.validate()&&!this.loadingForm){if(this.confirmationDialog=!1,await this.updateRecord([this.id,this.form]),!(0,r.n)(this.errors)){let t="";Object.entries(this.errors).forEach((([e,i])=>{i&&(t||(t=e),"dueDate"==e&&(this.invalidDueDateText=this.form.dueDate),this.$refs.form.validate(),this.$refs[t].focus())}))}null==this.form.agent&&this.$router.push({name:"MyQueue"})}},async sendReply(){if(this.reply){if(!this.loadingForm){const t={ticket_id:this.id,message:this.reply,attachments:this.attachment};await this.doReply(t),this.showReply=!1,this.attachment=null}}else alert("Reply is required.")},async download(t){this.downloading=!0;const e={id:t};await this.doDownload(e),this.downloading=!1},closeSolutionsDialog(){this.solutionsDialog=!1},closeTicketLogsDialog(){this.ticketLogsDialog=!1},closeConfirmationDialog(){this.confirmationDialog=!1},writeReply(){this.showReply=!0,this.reply=`Hi ${this.formatClientName},\n\n`}},filters:{dateFormat(t){return c()(t).format("MMM D, YYYY h:mm A")},setFromNow(t){return c()(t).fromNow()},nameFormat(t){return(0,l.g)(t)}},watch:{showReply(t){t&&setTimeout((()=>{this.$refs.reply.focus()}),200)}}},f=h,p=i(1001),g=i(3453),_=i.n(g),y=i(1835),b=i(680),k=i(3237),w=i(7118),D=i(2102),C=i(4228),x=i(1418),S=i(7781),R=i(6232),Z=i(6428),A=i(7047),V=i(7003),N=i(2877),T=i(4999),F=i(9762),$=i(5978),j=i(4350),L=(0,p.Z)(f,s,a,!1,null,"d2a813c8",null),Y=L.exports;_()(L,{VAutocomplete:y.Z,VBtn:b.Z,VCard:k.Z,VCardActions:w.h7,VCardSubtitle:w.Qq,VCardText:w.ZB,VCol:D.Z,VContainer:C.Z,VDivider:x.Z,VFileInput:S.Z,VForm:R.Z,VIcon:Z.Z,VImg:A.Z,VProgressLinear:V.Z,VRow:N.Z,VSelect:T.Z,VSpacer:F.Z,VTextField:$.Z,VTextarea:j.Z})}}]);
//# sourceMappingURL=ticketMyQueueEdit.6989243d.js.map